#ê°œë°œìš© ë„ì»¤ mysql(rds ì•„ë‹˜)
version: '3.8'

services:
  # 1. ë¡œì»¬ DB
  local-db:
    image: mysql:8.0
    container_name: timedeal-local-db
    environment:
      # (1) ë£¨íŠ¸ ë¹„ë°€ë²ˆí˜¸ (í•„ìˆ˜) -> .envì—ì„œ ê°€ì ¸ì˜´
      MYSQL_ROOT_PASSWORD: ${DB_PASSWORD}

      # (2) ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ì´ë¦„
      MYSQL_DATABASE: timedeal_db

      # ğŸ‘‡ [ì—¬ê¸°!] ì´ ë‘ ì¤„ì„ ë„£ì–´ì•¼ 'timedeal_dev' ê³„ì •ì´ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤!
      MYSQL_USER: timedeal_dev
      MYSQL_PASSWORD: ${DB_PASSWORD}
    ports:
      - "3306:3306"
    networks:
      - timedeal-net
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  # 2. ë°±ì—”ë“œ
  backend:
    build: ./backend
    container_name: timedeal-backend
    environment:
      # ì„œë¹„ìŠ¤ ì´ë¦„(local-db)ìœ¼ë¡œ ì ‘ì†
      SPRING_DATASOURCE_URL: jdbc:mysql://local-db:3306/timedeal_db?serverTimezone=Asia/Seoul&useSSL=false&allowPublicKeyRetrieval=true

      # ğŸ‘‡ ì´ì œ DB ì»¨í…Œì´ë„ˆê°€ ì´ ìœ ì €ë¥¼ ë§Œë“¤ì—ˆìœ¼ë‹ˆ, ì ‘ì† ê°€ëŠ¥í•©ë‹ˆë‹¤!
      SPRING_DATASOURCE_USERNAME: timedeal_dev
      SPRING_DATASOURCE_PASSWORD: ${DB_PASSWORD}

      FRONTEND_URL: http://localhost:3000
    ports:
      - "8080:8080"
    depends_on:
      - local-db
    networks:
      - timedeal-net

  # 3. í”„ë¡ íŠ¸ì—”ë“œ (ë³€ê²½ ì—†ìŒ)
  frontend:
    build:
      context: ./frontend
      args:
        REACT_APP_API_URL: http://localhost:3000/api
    ports:
      - "3000:80"
    depends_on:
      - backend
    networks:
      - timedeal-net

networks:
  timedeal-net:
    driver: bridge
